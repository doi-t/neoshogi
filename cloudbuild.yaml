steps:
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'build', '-f', './build/package/Dockerfile.firebase', '-t', 'gcr.io/$PROJECT_ID/firebase', '.' ]
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/firebase']
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-f', './build/package/Dockerfile.neoshogi', '-t', 'gcr.io/$PROJECT_ID/neoshogi', '.']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/neoshogi']
- name: "gcr.io/cloud-builders/gcloud"
  entrypoint: "bash"
  args:
    - "-c"
    - |
      gcloud beta run deploy neoshogi \
      --image gcr.io/$PROJECT_ID/neoshogi \
      --region asia-northeast1 \
      --platform managed \
      --allow-unauthenticated \
      --quiet
- name: 'gcr.io/$PROJECT_ID/firebase'
  args: [ 'deploy', '--only', 'hosting:neoshogi']
  secretEnv: ['FIREBASE_TOKEN', 'GOOGLE_APPLICATION_CREDENTIALS']
images:
- 'gcr.io/$PROJECT_ID/neoshogi'
- 'gcr.io/$PROJECT_ID/firebase'
secrets:
- kmsKeyName: projects/doi-t-alpha/locations/global/keyRings/neoshogi/cryptoKeys/firebase-token
  secretEnv:
    FIREBASE_TOKEN: CiQAfXuhstN4Y7o8UB2Jskzy+l1aZY/4ftfFk/d0MYLAE+P1ODQSVgAsLWaAnNk/SChgJM7GUKbuvT3LRfsQirHCbZ9BXfd8p/wwHbY9cSDi/fZW3umN6Zs/73BodHHGD4rONWDVVeJZYDoH7SgYQefS9Dn4zUV6OdmPXmco
- kmsKeyName: projects/doi-t-alpha/locations/global/keyRings/neoshogi/cryptoKeys/firebase-api-key
  secretEnv:
    GOOGLE_APPLICATION_CREDENTIALS: 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
